"use strict";(self["webpackChunkinspection_admin"]=self["webpackChunkinspection_admin"]||[]).push([[248],{2549:(e,a,l)=>{l.d(a,{N6:()=>c,TK:()=>o,aU:()=>n,bV:()=>m,hG:()=>d,iD:()=>r,nu:()=>i,ri:()=>u,ug:()=>s});var t=l(5659);function r(e){return(0,t.A)({url:"/auth/login",method:"post",data:e})}function s(){return(0,t.A)({url:"/users/info",method:"get"})}function u(){return(0,t.A)({url:"/auth/logout",method:"post"})}function n(e){return(0,t.A)({url:"/users",method:"get",params:e})}function i(e){return(0,t.A)({url:"/users",method:"post",data:e})}function o(e,a){return(0,t.A)({url:`/users/${e}`,method:"put",data:a})}function d(e){return(0,t.A)({url:`/users/${e}`,method:"delete"})}function m(e){return(0,t.A)({url:`/users/${e}/permissions`,method:"get"})}function c(e,a){return(0,t.A)({url:`/users/${e}/permissions`,method:"put",data:a})}},8248:(e,a,l)=>{l.r(a),l.d(a,{default:()=>C});var t=l(641),r=l(33);const s={class:"card"},u={class:"card"},n={style:{display:"flex","justify-content":"space-between","margin-bottom":"16px"}},i=["onClick"],o=["onClick"],d={style:{"margin-bottom":"8px"}},m={style:{"margin-bottom":"8px"}},c={style:{"margin-bottom":"8px"}},p={style:{"margin-bottom":"8px"}},_={style:{"margin-bottom":"8px"}},v={style:{"margin-bottom":"8px"}},b={style:{"margin-bottom":"8px"}},k={style:{"margin-bottom":"8px"}};function g(e,a,l,g,f,F){const h=(0,t.g2)("a-input"),y=(0,t.g2)("a-form-item"),W=(0,t.g2)("a-select-option"),x=(0,t.g2)("a-select"),w=(0,t.g2)("a-button"),C=(0,t.g2)("a-form"),L=(0,t.g2)("plus-outlined"),U=(0,t.g2)("a-tag"),q=(0,t.g2)("a-popconfirm"),A=(0,t.g2)("a-space"),P=(0,t.g2)("a-table"),M=(0,t.g2)("a-input-password"),S=(0,t.g2)("a-modal"),I=(0,t.g2)("a-checkbox"),K=(0,t.g2)("a-checkbox-group");return(0,t.uX)(),(0,t.CE)("div",null,[(0,t.Lk)("div",s,[a[26]||(a[26]=(0,t.Lk)("div",{class:"card-title"},"筛选条件",-1)),(0,t.bF)(C,{layout:"inline",model:e.queryParams},{default:(0,t.k6)((()=>[(0,t.bF)(y,{label:"用户名"},{default:(0,t.k6)((()=>[(0,t.bF)(h,{value:e.queryParams.username,"onUpdate:value":a[0]||(a[0]=a=>e.queryParams.username=a),placeholder:"请输入用户名"},null,8,["value"])])),_:1}),(0,t.bF)(y,{label:"部门"},{default:(0,t.k6)((()=>[(0,t.bF)(x,{value:e.queryParams.department,"onUpdate:value":a[1]||(a[1]=a=>e.queryParams.department=a),placeholder:"全部部门",style:{width:"160px"}},{default:(0,t.k6)((()=>[(0,t.bF)(W,{value:""},{default:(0,t.k6)((()=>a[13]||(a[13]=[(0,t.eW)("全部部门")]))),_:1,__:[13]}),(0,t.bF)(W,{value:"ops"},{default:(0,t.k6)((()=>a[14]||(a[14]=[(0,t.eW)("运维部")]))),_:1,__:[14]}),(0,t.bF)(W,{value:"security"},{default:(0,t.k6)((()=>a[15]||(a[15]=[(0,t.eW)("安全部")]))),_:1,__:[15]}),(0,t.bF)(W,{value:"it"},{default:(0,t.k6)((()=>a[16]||(a[16]=[(0,t.eW)("IT部")]))),_:1,__:[16]})])),_:1},8,["value"])])),_:1}),(0,t.bF)(y,{label:"角色"},{default:(0,t.k6)((()=>[(0,t.bF)(x,{value:e.queryParams.role,"onUpdate:value":a[2]||(a[2]=a=>e.queryParams.role=a),placeholder:"全部角色",style:{width:"160px"}},{default:(0,t.k6)((()=>[(0,t.bF)(W,{value:""},{default:(0,t.k6)((()=>a[17]||(a[17]=[(0,t.eW)("全部角色")]))),_:1,__:[17]}),(0,t.bF)(W,{value:"admin"},{default:(0,t.k6)((()=>a[18]||(a[18]=[(0,t.eW)("管理员")]))),_:1,__:[18]}),(0,t.bF)(W,{value:"user"},{default:(0,t.k6)((()=>a[19]||(a[19]=[(0,t.eW)("普通用户")]))),_:1,__:[19]})])),_:1},8,["value"])])),_:1}),(0,t.bF)(y,{label:"状态"},{default:(0,t.k6)((()=>[(0,t.bF)(x,{value:e.queryParams.status,"onUpdate:value":a[3]||(a[3]=a=>e.queryParams.status=a),placeholder:"全部状态",style:{width:"160px"}},{default:(0,t.k6)((()=>[(0,t.bF)(W,{value:""},{default:(0,t.k6)((()=>a[20]||(a[20]=[(0,t.eW)("全部状态")]))),_:1,__:[20]}),(0,t.bF)(W,{value:"active"},{default:(0,t.k6)((()=>a[21]||(a[21]=[(0,t.eW)("活跃")]))),_:1,__:[21]}),(0,t.bF)(W,{value:"inactive"},{default:(0,t.k6)((()=>a[22]||(a[22]=[(0,t.eW)("未激活")]))),_:1,__:[22]}),(0,t.bF)(W,{value:"locked"},{default:(0,t.k6)((()=>a[23]||(a[23]=[(0,t.eW)("已锁定")]))),_:1,__:[23]})])),_:1},8,["value"])])),_:1}),(0,t.bF)(y,null,{default:(0,t.k6)((()=>[(0,t.bF)(w,{type:"primary",onClick:e.handleQuery},{default:(0,t.k6)((()=>a[24]||(a[24]=[(0,t.eW)("查询")]))),_:1,__:[24]},8,["onClick"]),(0,t.bF)(w,{style:{"margin-left":"8px"},onClick:e.resetQuery},{default:(0,t.k6)((()=>a[25]||(a[25]=[(0,t.eW)("重置")]))),_:1,__:[25]},8,["onClick"])])),_:1})])),_:1},8,["model"])]),(0,t.Lk)("div",u,[(0,t.Lk)("div",n,[a[28]||(a[28]=(0,t.Lk)("div",{class:"card-title"},"用户列表",-1)),(0,t.bF)(w,{type:"primary",onClick:e.handleAdd},{icon:(0,t.k6)((()=>[(0,t.bF)(L)])),default:(0,t.k6)((()=>[a[27]||(a[27]=(0,t.eW)(" 添加用户 "))])),_:1,__:[27]},8,["onClick"])]),(0,t.bF)(P,{columns:e.columns,"data-source":e.userList,loading:e.loading,pagination:e.pagination,onChange:e.handleTableChange,"row-key":"id"},{bodyCell:(0,t.k6)((({column:l,record:s})=>["role"===l.key?((0,t.uX)(),(0,t.Wv)(U,{key:0,color:"admin"===s.role?"blue":"purple"},{default:(0,t.k6)((()=>[(0,t.eW)((0,r.v_)("admin"===s.role?"管理员":"普通用户"),1)])),_:2},1032,["color"])):"status"===l.key?((0,t.uX)(),(0,t.Wv)(U,{key:1,color:e.getStatusColor(s.status)},{default:(0,t.k6)((()=>[(0,t.eW)((0,r.v_)(e.getStatusText(s.status)),1)])),_:2},1032,["color"])):"action"===l.key?((0,t.uX)(),(0,t.Wv)(A,{key:2},{default:(0,t.k6)((()=>[(0,t.Lk)("a",{onClick:a=>e.handleEdit(s)},"编辑",8,i),(0,t.Lk)("a",{onClick:a=>e.handlePermission(s)},"权限",8,o),(0,t.bF)(q,{title:"确定要删除此用户吗？","ok-text":"确定","cancel-text":"取消",onConfirm:a=>e.handleDelete(s)},{default:(0,t.k6)((()=>a[29]||(a[29]=[(0,t.Lk)("a",{style:{color:"#ff4d4f"}},"删除",-1)]))),_:2,__:[29]},1032,["onConfirm"])])),_:2},1024)):(0,t.Q3)("",!0)])),_:1},8,["columns","data-source","loading","pagination","onChange"])]),(0,t.bF)(S,{visible:e.userModal.visible,"onUpdate:visible":a[10]||(a[10]=a=>e.userModal.visible=a),title:e.userModal.isEdit?"编辑用户":"添加用户",onOk:e.handleUserSubmit,onCancel:e.cancelUserModal,confirmLoading:e.userModal.loading},{default:(0,t.k6)((()=>[(0,t.bF)(C,{model:e.userForm,rules:e.rules,ref:"userFormRef","label-col":{span:6},"wrapper-col":{span:16}},{default:(0,t.k6)((()=>[(0,t.bF)(y,{label:"用户名",name:"username"},{default:(0,t.k6)((()=>[(0,t.bF)(h,{value:e.userForm.username,"onUpdate:value":a[4]||(a[4]=a=>e.userForm.username=a),placeholder:"请输入用户名"},null,8,["value"])])),_:1}),(0,t.bF)(y,{label:"姓名",name:"realname"},{default:(0,t.k6)((()=>[(0,t.bF)(h,{value:e.userForm.realname,"onUpdate:value":a[5]||(a[5]=a=>e.userForm.realname=a),placeholder:"请输入姓名"},null,8,["value"])])),_:1}),(0,t.bF)(y,{label:"密码",name:"password",rules:e.userModal.isEdit?[{required:!1}]:[{required:!0,message:"请输入密码"}]},{default:(0,t.k6)((()=>[(0,t.bF)(M,{value:e.userForm.password,"onUpdate:value":a[6]||(a[6]=a=>e.userForm.password=a),placeholder:"请输入密码"},null,8,["value"])])),_:1},8,["rules"]),(0,t.bF)(y,{label:"部门",name:"department"},{default:(0,t.k6)((()=>[(0,t.bF)(x,{value:e.userForm.department,"onUpdate:value":a[7]||(a[7]=a=>e.userForm.department=a),placeholder:"请选择部门"},{default:(0,t.k6)((()=>[(0,t.bF)(W,{value:"ops"},{default:(0,t.k6)((()=>a[30]||(a[30]=[(0,t.eW)("运维部")]))),_:1,__:[30]}),(0,t.bF)(W,{value:"security"},{default:(0,t.k6)((()=>a[31]||(a[31]=[(0,t.eW)("安全部")]))),_:1,__:[31]}),(0,t.bF)(W,{value:"it"},{default:(0,t.k6)((()=>a[32]||(a[32]=[(0,t.eW)("IT部")]))),_:1,__:[32]})])),_:1},8,["value"])])),_:1}),(0,t.bF)(y,{label:"角色",name:"role"},{default:(0,t.k6)((()=>[(0,t.bF)(x,{value:e.userForm.role,"onUpdate:value":a[8]||(a[8]=a=>e.userForm.role=a),placeholder:"请选择角色"},{default:(0,t.k6)((()=>[(0,t.bF)(W,{value:"user"},{default:(0,t.k6)((()=>a[33]||(a[33]=[(0,t.eW)("普通用户")]))),_:1,__:[33]}),(0,t.bF)(W,{value:"admin"},{default:(0,t.k6)((()=>a[34]||(a[34]=[(0,t.eW)("管理员")]))),_:1,__:[34]})])),_:1},8,["value"])])),_:1}),(0,t.bF)(y,{label:"状态",name:"status"},{default:(0,t.k6)((()=>[(0,t.bF)(x,{value:e.userForm.status,"onUpdate:value":a[9]||(a[9]=a=>e.userForm.status=a),placeholder:"请选择状态"},{default:(0,t.k6)((()=>[(0,t.bF)(W,{value:"active"},{default:(0,t.k6)((()=>a[35]||(a[35]=[(0,t.eW)("活跃")]))),_:1,__:[35]}),(0,t.bF)(W,{value:"inactive"},{default:(0,t.k6)((()=>a[36]||(a[36]=[(0,t.eW)("未激活")]))),_:1,__:[36]}),(0,t.bF)(W,{value:"locked"},{default:(0,t.k6)((()=>a[37]||(a[37]=[(0,t.eW)("已锁定")]))),_:1,__:[37]})])),_:1},8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["visible","title","onOk","onCancel","confirmLoading"]),(0,t.bF)(S,{visible:e.permissionModal.visible,"onUpdate:visible":a[12]||(a[12]=a=>e.permissionModal.visible=a),title:"权限设置",onOk:e.handlePermissionSubmit,onCancel:e.cancelPermissionModal,confirmLoading:e.permissionModal.loading},{title:(0,t.k6)((()=>[(0,t.eW)("权限设置 - "+(0,r.v_)(e.permissionModal.username),1)])),default:(0,t.k6)((()=>[(0,t.Lk)("div",null,[a[46]||(a[46]=(0,t.Lk)("div",{style:{"margin-bottom":"16px","font-weight":"bold"}},"权限分配",-1)),(0,t.bF)(K,{value:e.permissionForm.permissions,"onUpdate:value":a[11]||(a[11]=a=>e.permissionForm.permissions=a)},{default:(0,t.k6)((()=>[(0,t.Lk)("div",d,[(0,t.bF)(I,{value:"dashboard"},{default:(0,t.k6)((()=>a[38]||(a[38]=[(0,t.eW)("仪表盘查看权限")]))),_:1,__:[38]})]),(0,t.Lk)("div",m,[(0,t.bF)(I,{value:"records_view"},{default:(0,t.k6)((()=>a[39]||(a[39]=[(0,t.eW)("巡检记录查看权限")]))),_:1,__:[39]})]),(0,t.Lk)("div",c,[(0,t.bF)(I,{value:"records_all"},{default:(0,t.k6)((()=>a[40]||(a[40]=[(0,t.eW)("查看所有巡检记录（否则只能查看自己的记录）")]))),_:1,__:[40]})]),(0,t.Lk)("div",p,[(0,t.bF)(I,{value:"records_export"},{default:(0,t.k6)((()=>a[41]||(a[41]=[(0,t.eW)("巡检记录导出权限")]))),_:1,__:[41]})]),(0,t.Lk)("div",_,[(0,t.bF)(I,{value:"issues_view"},{default:(0,t.k6)((()=>a[42]||(a[42]=[(0,t.eW)("问题列表查看权限")]))),_:1,__:[42]})]),(0,t.Lk)("div",v,[(0,t.bF)(I,{value:"issues_edit"},{default:(0,t.k6)((()=>a[43]||(a[43]=[(0,t.eW)("问题处理权限")]))),_:1,__:[43]})]),(0,t.Lk)("div",b,[(0,t.bF)(I,{value:"user_manage"},{default:(0,t.k6)((()=>a[44]||(a[44]=[(0,t.eW)("用户管理权限")]))),_:1,__:[44]})]),(0,t.Lk)("div",k,[(0,t.bF)(I,{value:"system_config"},{default:(0,t.k6)((()=>a[45]||(a[45]=[(0,t.eW)("系统配置权限")]))),_:1,__:[45]})])])),_:1},8,["value"])])])),_:1},8,["visible","onOk","onCancel","confirmLoading"])])}var f=l(953),F=l(8787),h=l(5870),y=l(2549);const W=(0,t.pM)({name:"Users",components:{PlusOutlined:h.A},setup(){const e=[{title:"用户名",dataIndex:"username",key:"username"},{title:"姓名",dataIndex:"realname",key:"realname"},{title:"部门",dataIndex:"department",key:"department"},{title:"角色",dataIndex:"role",key:"role"},{title:"状态",dataIndex:"status",key:"status"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"操作",key:"action"}],a=(0,f.Kh)({username:"",department:"",role:"",status:"",pageNum:1,pageSize:10}),l=(0,f.Kh)({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),r=(0,f.KR)(!1),s=(0,f.KR)([]),u=(0,f.KR)(null),n=(0,f.Kh)({id:null,username:"",realname:"",password:"",department:"ops",role:"user",status:"active"}),i={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],realname:[{required:!0,message:"请输入姓名",trigger:"blur"}],department:[{required:!0,message:"请选择部门",trigger:"change"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},o=(0,f.Kh)({visible:!1,loading:!1,isEdit:!1}),d=(0,f.Kh)({visible:!1,loading:!1,userId:null,username:""}),m=(0,f.Kh)({permissions:[]}),c=async()=>{r.value=!0;try{const{list:e,total:t}=await(0,y.aU)({...a});s.value=e,l.total=t,l.current=a.pageNum,l.pageSize=a.pageSize}catch(e){console.error("Failed to get user list:",e)}finally{r.value=!1}},p=()=>{a.pageNum=1,c()},_=()=>{Object.assign(a,{username:"",department:"",role:"",status:"",pageNum:1,pageSize:10}),c()},v=e=>{a.pageNum=e.current,a.pageSize=e.pageSize,c()},b=e=>{switch(e){case"active":return"green";case"inactive":return"orange";case"locked":return"red";default:return"default"}},k=e=>{switch(e){case"active":return"活跃";case"inactive":return"未激活";case"locked":return"已锁定";default:return e}},g=()=>{o.isEdit=!1,o.visible=!0,n.id=null,n.username="",n.realname="",n.password="",n.department="ops",n.role="user",n.status="active"},h=e=>{o.isEdit=!0,o.visible=!0,Object.assign(n,{id:e.id,username:e.username,realname:e.realname,password:"",department:e.department,role:e.role,status:e.status})},W=async()=>{try{await u.value.validate(),o.loading=!0;const e=(0,f.ux)(n);o.isEdit?(await(0,y.TK)(e.id,e),F.Ay.success("更新用户成功")):(await(0,y.nu)(e),F.Ay.success("添加用户成功")),o.visible=!1,c()}catch(e){console.error("Form validation failed:",e)}finally{o.loading=!1}},x=()=>{o.visible=!1,u.value?.resetFields()},w=async e=>{try{await(0,y.hG)(e.id),F.Ay.success("删除用户成功"),c()}catch(a){console.error("Failed to delete user:",a)}},C=async e=>{d.userId=e.id,d.username=e.username,d.visible=!0,d.loading=!0;try{const a=await(0,y.bV)(e.id);m.permissions=a||[]}catch(a){console.error("Failed to get user permissions:",a)}finally{d.loading=!1}},L=async()=>{d.loading=!0;try{await(0,y.N6)(d.userId,{permissions:(0,f.ux)(m.permissions)}),F.Ay.success("权限设置成功"),d.visible=!1}catch(e){console.error("Failed to update permissions:",e)}finally{d.loading=!1}},U=()=>{d.visible=!1};return(0,t.sV)((()=>{c()})),{columns:e,queryParams:a,pagination:l,loading:r,userList:s,userFormRef:u,userForm:n,rules:i,userModal:o,permissionModal:d,permissionForm:m,handleQuery:p,resetQuery:_,handleTableChange:v,getStatusColor:b,getStatusText:k,handleAdd:g,handleEdit:h,handleUserSubmit:W,cancelUserModal:x,handleDelete:w,handlePermission:C,handlePermissionSubmit:L,cancelPermissionModal:U}}});var x=l(6262);const w=(0,x.A)(W,[["render",g]]),C=w}}]);
//# sourceMappingURL=248.db618e56.js.map