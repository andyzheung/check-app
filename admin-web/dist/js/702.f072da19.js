"use strict";(self["webpackChunkinspection_admin"]=self["webpackChunkinspection_admin"]||[]).push([[702],{695:(e,a,t)=>{t.d(a,{ES:()=>s,Hh:()=>o,Rp:()=>i,Uh:()=>n,bi:()=>r});var l=t(5659);function s(e){return(0,l.A)({url:"/issues",method:"get",params:e})}function i(e){return(0,l.A)({url:`/issues/${e}`,method:"get"})}function o(e,a){return(0,l.A)({url:`/issues/${e}/process`,method:"post",data:a})}function r(e){return(0,l.A)({url:"/issues/export",method:"get",params:e,responseType:"blob"})}function n(){return(0,l.A)({url:"/issues/weekly",method:"get"})}},7702:(e,a,t)=>{t.r(a),t.d(a,{default:()=>F});var l=t(641),s=t(33);const i={class:"card"},o={class:"card"},r={style:{display:"flex","justify-content":"space-between","margin-bottom":"16px"}},n=["onClick"],u={style:{padding:"8px"}},d={key:1,style:{padding:"8px"}},c={key:3,style:{padding:"8px"}},p={style:{"margin-top":"24px","text-align":"right"}};function _(e,a,t,_,k,g){const v=(0,l.g2)("a-range-picker"),m=(0,l.g2)("a-form-item"),b=(0,l.g2)("a-select-option"),y=(0,l.g2)("a-select"),f=(0,l.g2)("a-button"),h=(0,l.g2)("a-form"),F=(0,l.g2)("download-outlined"),C=(0,l.g2)("a-tag"),W=(0,l.g2)("a-table"),w=(0,l.g2)("a-descriptions-item"),x=(0,l.g2)("a-descriptions"),D=(0,l.g2)("a-divider"),T=(0,l.g2)("a-timeline-item"),R=(0,l.g2)("a-timeline"),I=(0,l.g2)("a-textarea"),L=(0,l.g2)("a-radio"),X=(0,l.g2)("a-radio-group"),K=(0,l.g2)("a-modal");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("div",i,[a[18]||(a[18]=(0,l.Lk)("div",{class:"card-title"},"筛选条件",-1)),(0,l.bF)(h,{layout:"inline",model:e.queryParams},{default:(0,l.k6)((()=>[(0,l.bF)(m,{label:"时间范围"},{default:(0,l.k6)((()=>[(0,l.bF)(v,{value:e.dateRange,"onUpdate:value":a[0]||(a[0]=a=>e.dateRange=a),format:"YYYY-MM-DD",placeholder:["开始日期","结束日期"],onChange:e.onDateRangeChange},null,8,["value","onChange"])])),_:1}),(0,l.bF)(m,{label:"问题类型"},{default:(0,l.k6)((()=>[(0,l.bF)(y,{value:e.queryParams.type,"onUpdate:value":a[1]||(a[1]=a=>e.queryParams.type=a),placeholder:"全部类型",style:{width:"160px"},allowClear:""},{default:(0,l.k6)((()=>[(0,l.bF)(b,{value:""},{default:(0,l.k6)((()=>a[8]||(a[8]=[(0,l.eW)("全部类型")]))),_:1,__:[8]}),(0,l.bF)(b,{value:"device"},{default:(0,l.k6)((()=>a[9]||(a[9]=[(0,l.eW)("设备异常")]))),_:1,__:[9]}),(0,l.bF)(b,{value:"environment"},{default:(0,l.k6)((()=>a[10]||(a[10]=[(0,l.eW)("环境异常")]))),_:1,__:[10]}),(0,l.bF)(b,{value:"security"},{default:(0,l.k6)((()=>a[11]||(a[11]=[(0,l.eW)("安全隐患")]))),_:1,__:[11]}),(0,l.bF)(b,{value:"other"},{default:(0,l.k6)((()=>a[12]||(a[12]=[(0,l.eW)("其他")]))),_:1,__:[12]})])),_:1},8,["value"])])),_:1}),(0,l.bF)(m,{label:"记录人员"},{default:(0,l.k6)((()=>[(0,l.bF)(y,{value:e.queryParams.recorderId,"onUpdate:value":a[2]||(a[2]=a=>e.queryParams.recorderId=a),placeholder:"全部人员",style:{width:"160px"},allowClear:""},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.userOptions,(e=>((0,l.uX)(),(0,l.Wv)(b,{key:e.id,value:e.id},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),(0,l.bF)(m,{label:"问题状态"},{default:(0,l.k6)((()=>[(0,l.bF)(y,{value:e.queryParams.status,"onUpdate:value":a[3]||(a[3]=a=>e.queryParams.status=a),placeholder:"全部状态",style:{width:"160px"},allowClear:""},{default:(0,l.k6)((()=>[(0,l.bF)(b,{value:""},{default:(0,l.k6)((()=>a[13]||(a[13]=[(0,l.eW)("全部状态")]))),_:1,__:[13]}),(0,l.bF)(b,{value:"open"},{default:(0,l.k6)((()=>a[14]||(a[14]=[(0,l.eW)("未闭环")]))),_:1,__:[14]}),(0,l.bF)(b,{value:"closed"},{default:(0,l.k6)((()=>a[15]||(a[15]=[(0,l.eW)("已闭环")]))),_:1,__:[15]})])),_:1},8,["value"])])),_:1}),(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.bF)(f,{type:"primary",onClick:e.handleQuery},{default:(0,l.k6)((()=>a[16]||(a[16]=[(0,l.eW)("查询")]))),_:1,__:[16]},8,["onClick"]),(0,l.bF)(f,{style:{"margin-left":"8px"},onClick:e.resetQuery},{default:(0,l.k6)((()=>a[17]||(a[17]=[(0,l.eW)("重置")]))),_:1,__:[17]},8,["onClick"])])),_:1})])),_:1},8,["model"])]),(0,l.Lk)("div",o,[(0,l.Lk)("div",r,[a[20]||(a[20]=(0,l.Lk)("div",{class:"card-title"},"问题列表",-1)),(0,l.Lk)("div",null,[(0,l.bF)(f,{onClick:e.handleExport},{icon:(0,l.k6)((()=>[(0,l.bF)(F)])),default:(0,l.k6)((()=>[a[19]||(a[19]=(0,l.eW)(" 导出 "))])),_:1,__:[19]},8,["onClick"])])]),(0,l.bF)(W,{columns:e.columns,"data-source":e.issueList,loading:e.loading,pagination:e.pagination,onChange:e.handleTableChange,"row-key":"id"},{bodyCell:(0,l.k6)((({column:a,record:t})=>["status"===a.key?((0,l.uX)(),(0,l.Wv)(C,{key:0,color:"open"===t.status?"red":"green"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)("open"===t.status?"未闭环":"已闭环"),1)])),_:2},1032,["color"])):"action"===a.key?((0,l.uX)(),(0,l.CE)("a",{key:1,onClick:a=>e.showDetail(t)},"查看详情",8,n)):(0,l.Q3)("",!0)])),_:1},8,["columns","data-source","loading","pagination","onChange"])]),(0,l.bF)(K,{visible:e.detailVisible,"onUpdate:visible":a[7]||(a[7]=a=>e.detailVisible=a),title:"问题详情",width:"700px",footer:null},{default:(0,l.k6)((()=>[(0,l.bF)(x,{bordered:"",column:2},{default:(0,l.k6)((()=>[(0,l.bF)(w,{label:"问题编号",span:2},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(e.issueDetail.id),1)])),_:1}),(0,l.bF)(w,{label:"问题描述",span:2},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(e.issueDetail.description),1)])),_:1}),(0,l.bF)(w,{label:"问题类型"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(e.getTypeText(e.issueDetail.type)),1)])),_:1}),(0,l.bF)(w,{label:"发生时间"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(e.issueDetail.createTime),1)])),_:1}),(0,l.bF)(w,{label:"记录人员"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(e.issueDetail.recorderName),1)])),_:1}),(0,l.bF)(w,{label:"问题状态"},{default:(0,l.k6)((()=>[(0,l.bF)(C,{color:"open"===e.issueDetail.status?"red":"green"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)("open"===e.issueDetail.status?"未闭环":"已闭环"),1)])),_:1},8,["color"])])),_:1})])),_:1}),(0,l.bF)(D,{orientation:"left"},{default:(0,l.k6)((()=>a[21]||(a[21]=[(0,l.eW)("问题详情")]))),_:1,__:[21]}),(0,l.Lk)("div",u,(0,s.v_)(e.issueDetail.detail||"无"),1),(0,l.bF)(D,{orientation:"left"},{default:(0,l.k6)((()=>a[22]||(a[22]=[(0,l.eW)("处理记录")]))),_:1,__:[22]}),e.issueDetail.processRecords&&e.issueDetail.processRecords.length>0?((0,l.uX)(),(0,l.Wv)(R,{key:0},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.issueDetail.processRecords,((a,t)=>((0,l.uX)(),(0,l.Wv)(T,{key:t,color:e.getTimelineColor(a.action)},{default:(0,l.k6)((()=>[(0,l.Lk)("p",null,[(0,l.Lk)("strong",null,(0,s.v_)(a.action),1),(0,l.eW)(" - "+(0,s.v_)(a.time),1)]),(0,l.Lk)("p",null,"处理人: "+(0,s.v_)(a.processor),1),(0,l.Lk)("p",null,(0,s.v_)(a.content),1)])),_:2},1032,["color"])))),128))])),_:1})):((0,l.uX)(),(0,l.CE)("div",d,"暂无处理记录")),"open"===e.issueDetail.status?((0,l.uX)(),(0,l.Wv)(D,{key:2,orientation:"left"},{default:(0,l.k6)((()=>a[23]||(a[23]=[(0,l.eW)("问题处理")]))),_:1,__:[23]})):(0,l.Q3)("",!0),"open"===e.issueDetail.status?((0,l.uX)(),(0,l.CE)("div",c,[(0,l.bF)(h,{model:e.processForm,layout:"vertical"},{default:(0,l.k6)((()=>[(0,l.bF)(m,{label:"处理意见",name:"content"},{default:(0,l.k6)((()=>[(0,l.bF)(I,{value:e.processForm.content,"onUpdate:value":a[4]||(a[4]=a=>e.processForm.content=a),rows:"4",placeholder:"请输入处理意见"},null,8,["value"])])),_:1}),(0,l.bF)(m,{label:"处理结果",name:"action"},{default:(0,l.k6)((()=>[(0,l.bF)(X,{value:e.processForm.action,"onUpdate:value":a[5]||(a[5]=a=>e.processForm.action=a)},{default:(0,l.k6)((()=>[(0,l.bF)(L,{value:"process"},{default:(0,l.k6)((()=>a[24]||(a[24]=[(0,l.eW)("处理中")]))),_:1,__:[24]}),(0,l.bF)(L,{value:"close"},{default:(0,l.k6)((()=>a[25]||(a[25]=[(0,l.eW)("关闭问题")]))),_:1,__:[25]})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])):(0,l.Q3)("",!0),(0,l.Lk)("div",p,[(0,l.bF)(f,{onClick:a[6]||(a[6]=a=>e.detailVisible=!1),style:{"margin-right":"8px"}},{default:(0,l.k6)((()=>a[26]||(a[26]=[(0,l.eW)("取消")]))),_:1,__:[26]}),"open"===e.issueDetail.status?((0,l.uX)(),(0,l.Wv)(f,{key:0,type:"primary",onClick:e.handleProcess},{default:(0,l.k6)((()=>a[27]||(a[27]=[(0,l.eW)("提交")]))),_:1,__:[27]},8,["onClick"])):(0,l.Q3)("",!0)])])),_:1},8,["visible"])])}var k=t(953),g=t(8787),v=t(912),m=t(695),b=t(2549);t(5093);const y=(0,l.pM)({name:"Issues",components:{DownloadOutlined:v.A},setup(){const e=[{title:"问题编号",dataIndex:"id",key:"id",width:140},{title:"问题描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"问题类型",dataIndex:"type",key:"type",customRender:({text:e})=>f(e)},{title:"发生时间",dataIndex:"createTime",key:"createTime",sorter:!0},{title:"记录人员",dataIndex:"recorderName",key:"recorderName"},{title:"问题状态",dataIndex:"status",key:"status"},{title:"操作",key:"action",width:100}],a=(0,k.Kh)({startTime:"",endTime:"",type:"",recorderId:"",status:"",pageNum:1,pageSize:10}),t=(0,k.KR)([]),s=(0,k.Kh)({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),i=(0,k.KR)(!1),o=(0,k.KR)([]),r=(0,k.KR)([]),n=(0,k.KR)(!1),u=(0,k.KR)({}),d=(0,k.Kh)({content:"",action:"process"}),c=async()=>{i.value=!0;try{const{list:e,total:t}=await(0,m.ES)({...a});o.value=e,s.total=t,s.current=a.pageNum,s.pageSize=a.pageSize}catch(e){console.error("Failed to get issue list:",e)}finally{i.value=!1}},p=(e,t)=>{a.startTime=t[0],a.endTime=t[1]},_=()=>{a.pageNum=1,c()},v=()=>{t.value=[],Object.assign(a,{startTime:"",endTime:"",type:"",recorderId:"",status:"",pageNum:1,pageSize:10}),c()},y=(e,t,l)=>{a.pageNum=e.current,a.pageSize=e.pageSize,l&&l.field?(a.sortField=l.field,a.sortOrder=l.order):(a.sortField=void 0,a.sortOrder=void 0),c()},f=e=>{switch(e){case"device":return"设备异常";case"environment":return"环境异常";case"security":return"安全隐患";case"other":return"其他";default:return e}},h=e=>{switch(e){case"create":return"blue";case"process":return"orange";case"close":return"green";default:return"gray"}},F=async e=>{try{const a=await(0,m.Rp)(e.id);u.value=a,n.value=!0,d.content="",d.action="process"}catch(a){console.error("Failed to get issue detail:",a)}},C=async()=>{if(d.content)try{await(0,m.Hh)(u.value.id,{content:d.content,action:d.action}),g.Ay.success("问题处理成功"),n.value=!1,c()}catch(e){console.error("Failed to process issue:",e)}else g.Ay.error("请输入处理意见")},W=async()=>{try{await(0,m.bi)(a),g.Ay.success("导出成功")}catch(e){console.error("Failed to export issues:",e)}},w=async()=>{try{const{list:e}=await(0,b.aU)({pageSize:100});r.value=e.map((e=>({id:e.id,name:e.realname})))}catch(e){console.error("Failed to get user options:",e)}};return(0,l.sV)((()=>{c(),w()})),{columns:e,queryParams:a,dateRange:t,pagination:s,loading:i,issueList:o,userOptions:r,detailVisible:n,issueDetail:u,processForm:d,onDateRangeChange:p,handleQuery:_,resetQuery:v,handleTableChange:y,getTypeText:f,getTimelineColor:h,showDetail:F,handleProcess:C,handleExport:W}}});var f=t(6262);const h=(0,f.A)(y,[["render",_],["__scopeId","data-v-a93c02bc"]]),F=h}}]);
//# sourceMappingURL=702.f072da19.js.map