"use strict";(self["webpackChunkinspection_admin"]=self["webpackChunkinspection_admin"]||[]).push([[815],{3815:(e,a,t)=>{t.r(a),t.d(a,{default:()=>w});var r=t(641),l=t(33);const o={class:"card"},n={class:"card"},i={style:{display:"flex","justify-content":"space-between","margin-bottom":"16px"}},d=["onClick"],s={style:{padding:"8px"}},u={style:{"margin-top":"24px","text-align":"right"}};function c(e,a,t,c,m,p){const k=(0,r.g2)("a-range-picker"),g=(0,r.g2)("a-form-item"),y=(0,r.g2)("a-select-option"),v=(0,r.g2)("a-select"),b=(0,r.g2)("a-button"),_=(0,r.g2)("a-form"),f=(0,r.g2)("download-outlined"),h=(0,r.g2)("a-tag"),F=(0,r.g2)("a-table"),C=(0,r.g2)("a-descriptions-item"),w=(0,r.g2)("a-descriptions"),x=(0,r.g2)("a-divider"),I=(0,r.g2)("a-modal");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.Lk)("div",o,[a[10]||(a[10]=(0,r.Lk)("div",{class:"card-title"},"筛选条件",-1)),(0,r.bF)(_,{layout:"inline",model:e.queryParams},{default:(0,r.k6)((()=>[(0,r.bF)(g,{label:"时间范围"},{default:(0,r.k6)((()=>[(0,r.bF)(k,{value:e.dateRange,"onUpdate:value":a[0]||(a[0]=a=>e.dateRange=a),format:"YYYY-MM-DD",placeholder:["开始日期","结束日期"],onChange:e.onDateRangeChange},null,8,["value","onChange"])])),_:1}),(0,r.bF)(g,{label:"巡检区域"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{value:e.queryParams.areaId,"onUpdate:value":a[1]||(a[1]=a=>e.queryParams.areaId=a),placeholder:"全部区域",style:{width:"160px"},allowClear:""},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.areaOptions,(e=>((0,r.uX)(),(0,r.Wv)(y,{key:e.id,value:e.id},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),(0,r.bF)(g,{label:"巡检人员"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{value:e.queryParams.inspectorId,"onUpdate:value":a[2]||(a[2]=a=>e.queryParams.inspectorId=a),placeholder:"全部人员",style:{width:"160px"},allowClear:""},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.userOptions,(e=>((0,r.uX)(),(0,r.Wv)(y,{key:e.id,value:e.id},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),(0,r.bF)(g,{label:"巡检状态"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{value:e.queryParams.status,"onUpdate:value":a[3]||(a[3]=a=>e.queryParams.status=a),placeholder:"全部状态",style:{width:"160px"},allowClear:""},{default:(0,r.k6)((()=>[(0,r.bF)(y,{value:"normal"},{default:(0,r.k6)((()=>a[6]||(a[6]=[(0,r.eW)("正常")]))),_:1,__:[6]}),(0,r.bF)(y,{value:"abnormal"},{default:(0,r.k6)((()=>a[7]||(a[7]=[(0,r.eW)("异常")]))),_:1,__:[7]})])),_:1},8,["value"])])),_:1}),(0,r.bF)(g,null,{default:(0,r.k6)((()=>[(0,r.bF)(b,{type:"primary",onClick:e.handleQuery},{default:(0,r.k6)((()=>a[8]||(a[8]=[(0,r.eW)("查询")]))),_:1,__:[8]},8,["onClick"]),(0,r.bF)(b,{style:{"margin-left":"8px"},onClick:e.resetQuery},{default:(0,r.k6)((()=>a[9]||(a[9]=[(0,r.eW)("重置")]))),_:1,__:[9]},8,["onClick"])])),_:1})])),_:1},8,["model"])]),(0,r.Lk)("div",n,[(0,r.Lk)("div",i,[a[12]||(a[12]=(0,r.Lk)("div",{class:"card-title"},"巡检记录",-1)),(0,r.Lk)("div",null,[(0,r.bF)(b,{type:"primary",onClick:e.handleExport,style:{"margin-right":"8px"}},{icon:(0,r.k6)((()=>[(0,r.bF)(f)])),default:(0,r.k6)((()=>[a[11]||(a[11]=(0,r.eW)(" 导出 "))])),_:1,__:[11]},8,["onClick"])])]),(0,r.bF)(F,{columns:e.columns,"data-source":e.recordList,loading:e.loading,pagination:e.pagination,onChange:e.handleTableChange,"row-key":"id"},{bodyCell:(0,r.k6)((({column:a,record:t})=>["status"===a.key?((0,r.uX)(),(0,r.Wv)(h,{key:0,color:"normal"===t.status?"green":"red"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)("normal"===t.status?"正常":"异常"),1)])),_:2},1032,["color"])):"action"===a.key?((0,r.uX)(),(0,r.CE)("a",{key:1,onClick:a=>e.showDetail(t)},"查看详情",8,d)):(0,r.Q3)("",!0)])),_:1},8,["columns","data-source","loading","pagination","onChange"])]),(0,r.bF)(I,{visible:e.detailVisible,"onUpdate:visible":a[5]||(a[5]=a=>e.detailVisible=a),title:"巡检详情",width:"700px",footer:null},{default:(0,r.k6)((()=>[(0,r.bF)(w,{bordered:"",column:2},{default:(0,r.k6)((()=>[(0,r.bF)(C,{label:"巡检ID",span:2},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.recordDetail.id),1)])),_:1}),(0,r.bF)(C,{label:"巡检区域"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.recordDetail.areaName),1)])),_:1}),(0,r.bF)(C,{label:"巡检人员"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.recordDetail.inspectorName),1)])),_:1}),(0,r.bF)(C,{label:"巡检时间"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.recordDetail.inspectionTime),1)])),_:1}),(0,r.bF)(C,{label:"巡检状态"},{default:(0,r.k6)((()=>[(0,r.bF)(h,{color:"normal"===e.recordDetail.status?"green":"red"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)("normal"===e.recordDetail.status?"正常":"异常"),1)])),_:1},8,["color"])])),_:1})])),_:1}),(0,r.bF)(x,{orientation:"left"},{default:(0,r.k6)((()=>a[13]||(a[13]=[(0,r.eW)("环境巡检项")]))),_:1,__:[13]}),(0,r.bF)(F,{columns:e.environmentColumns,"data-source":e.recordDetail.environmentItems||[],pagination:!1,size:"small"},{bodyCell:(0,r.k6)((({column:e,record:a})=>["status"===e.key?((0,r.uX)(),(0,r.Wv)(h,{key:0,color:"normal"===a.status?"green":"red"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)("normal"===a.status?"正常":"异常"),1)])),_:2},1032,["color"])):(0,r.Q3)("",!0)])),_:1},8,["columns","data-source"]),(0,r.bF)(x,{orientation:"left"},{default:(0,r.k6)((()=>a[14]||(a[14]=[(0,r.eW)("安全巡检项")]))),_:1,__:[14]}),(0,r.bF)(F,{columns:e.securityColumns,"data-source":e.recordDetail.securityItems||[],pagination:!1,size:"small"},{bodyCell:(0,r.k6)((({column:e,record:a})=>["status"===e.key?((0,r.uX)(),(0,r.Wv)(h,{key:0,color:"normal"===a.status?"green":"red"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)("normal"===a.status?"正常":"异常"),1)])),_:2},1032,["color"])):(0,r.Q3)("",!0)])),_:1},8,["columns","data-source"]),(0,r.bF)(x,{orientation:"left"},{default:(0,r.k6)((()=>a[15]||(a[15]=[(0,r.eW)("备注信息")]))),_:1,__:[15]}),(0,r.Lk)("div",s,(0,l.v_)(e.recordDetail.remark||"无"),1),(0,r.Lk)("div",u,[(0,r.bF)(b,{onClick:a[4]||(a[4]=a=>e.detailVisible=!1)},{default:(0,r.k6)((()=>a[16]||(a[16]=[(0,r.eW)("关闭")]))),_:1,__:[16]})])])),_:1},8,["visible"])])}var m=t(953),p=t(8787),k=t(912),g=t(8443),y=t(5659);function v(e){return(0,y.A)({url:"/areas",method:"get",params:e})}var b=t(2549),_=t(5093),f=t.n(_);const h=(0,r.pM)({name:"Records",components:{DownloadOutlined:k.A},setup(){const e=[{title:"巡检ID",dataIndex:"id",key:"id",width:80},{title:"巡检区域",dataIndex:"areaName",key:"areaName"},{title:"巡检人员",dataIndex:"inspectorName",key:"inspectorName"},{title:"巡检时间",dataIndex:"inspectionTime",key:"inspectionTime",sorter:!0},{title:"状态",dataIndex:"status",key:"status"},{title:"操作",key:"action",width:120}],a=[{title:"巡检项",dataIndex:"name",key:"name"},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"备注",dataIndex:"remark",key:"remark"}],t=[{title:"巡检项",dataIndex:"name",key:"name"},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"备注",dataIndex:"remark",key:"remark"}],l=(0,m.Kh)({startTime:"",endTime:"",areaId:void 0,inspectorId:void 0,status:void 0,pageNum:1,pageSize:10}),o=(0,m.KR)([]),n=(e,a)=>{e?(l.startTime=a[0],l.endTime=a[1]):(l.startTime="",l.endTime="")},i=(0,m.Kh)({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),d=(0,m.KR)(!1),s=(0,m.KR)([]),u=(0,m.KR)([]),c=(0,m.KR)([]),k=(0,m.KR)(!1),y=(0,m.Kh)({id:"",areaName:"",inspectorName:"",inspectionTime:"",status:"normal",environmentItems:[],securityItems:[],remark:""}),_=async()=>{d.value=!0;try{const{list:e,total:a}=await(0,g.a1)({...l});s.value=e,i.total=a,i.current=l.pageNum,i.pageSize=l.pageSize}catch(e){console.error("Failed to get record list:",e)}finally{d.value=!1}},h=async()=>{try{const e=await v({pageSize:100});u.value=e.list||[]}catch(e){console.error("Failed to get area options:",e)}},F=async()=>{try{const e=await(0,b.aU)({pageSize:100});c.value=e.list||[]}catch(e){console.error("Failed to get user options:",e)}},C=()=>{l.pageNum=1,_()},w=()=>{o.value=[],Object.assign(l,{startTime:"",endTime:"",areaId:void 0,inspectorId:void 0,status:void 0,pageNum:1,pageSize:10}),_()},x=(e,a,t)=>{l.pageNum=e.current,l.pageSize=e.pageSize,t&&t.field?(l.sortField=t.field,l.sortOrder="ascend"===t.order?"asc":"desc"):(l.sortField=void 0,l.sortOrder=void 0),_()},I=async e=>{try{const a=await(0,g.tF)(e.id);Object.assign(y,a),k.value=!0}catch(a){console.error("Failed to get record detail:",a)}},W=async()=>{try{p.Ay.loading("正在导出数据...",0);const e=await(0,g.HC)({...l,pageNum:void 0,pageSize:void 0}),a=window.URL.createObjectURL(e),t=document.createElement("a");t.href=a,t.download=`巡检记录_${f()().format("YYYY-MM-DD")}.xlsx`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(a),p.Ay.destroy(),p.Ay.success("导出成功")}catch(e){p.Ay.destroy(),p.Ay.error("导出失败"),console.error("Failed to export records:",e)}};return(0,r.sV)((()=>{_(),h(),F()})),{columns:e,environmentColumns:a,securityColumns:t,queryParams:l,dateRange:o,pagination:i,loading:d,recordList:s,areaOptions:u,userOptions:c,detailVisible:k,recordDetail:y,onDateRangeChange:n,handleQuery:C,resetQuery:w,handleTableChange:x,showDetail:I,handleExport:W}}});var F=t(6262);const C=(0,F.A)(h,[["render",c]]),w=C},8443:(e,a,t)=>{t.d(a,{$:()=>d,HC:()=>n,Hv:()=>i,UP:()=>s,a1:()=>l,sk:()=>u,tF:()=>o});var r=t(5659);function l(e){return(0,r.A)({url:"/records",method:"get",params:e})}function o(e){return(0,r.A)({url:`/records/${e}`,method:"get"})}function n(e){return(0,r.A)({url:"/records/export",method:"get",params:e,responseType:"blob"})}function i(){return(0,r.A)({url:"/records/stats",method:"get"})}function d(){return(0,r.A)({url:"/records/weekly-trend",method:"get"})}function s(){return(0,r.A)({url:"/records/issue-distribution",method:"get"})}function u(){return(0,r.A)({url:"/records/inspector-ranking",method:"get"})}}}]);
//# sourceMappingURL=815.edc8e295.js.map